# 数据库设计

| 序号 | 中文名称       | 数据库名              |
| ---- | -------------- | --------------------- |
| 1    | 用户表         | user                  |
| 2    | 订单表         | user_order            |
| 3    | 订单明细表     | order_detail          |
| 4    | 地址表         | user_address          |
| 5    | 商品表         | product               |
| 6    | 规格表         | product_spec          |
| 7    | 管理员表       | admin                 |
| 8    | 分类表         | product_sort          |
| 9    | 商品图片表     | product_static        |
| 10   | 聊天表         | chat                  |
| 11   | 收藏表         | user_collect          |
| 12   | 评价与信用表   | user_comment          |
| 13   | 店铺表         | shop                  |
| 14   | 优惠活动主表   | Promotions            |
| 15   | 优惠规则表     | Promotion_Rules       |
| 16   | 活动商品关联表 | Promotion_Product_Map |
| 17   | 优惠券模板表   | Coupon_Templates      |
| 18   | 用户优惠券表   | User_Coupons          |

## 用户表

| 字段       | 数据类型                 | 说明                        | 备注              |
| ---------- | ------------------------ | --------------------------- | ----------------- |
| id         | bigint                   | 主键                        | 自增              |
| userSn     | varchar(255)             | 用户标识号                  | 唯一              |
| username   | varchar(25)              | 用户名                      | 唯一              |
| password   | varchar(64)              | 密码                        |                   |
| nickname   | varchar(25)              | 昵称                        |                   |
| email      | varchar(64)              | 邮箱                        | 唯一              |
| phone      | varchar(18)              | 手机号                      | 唯一              |
| avatar     | varchar(255)             | 头像地址                    |                   |
| status     | tinyint                  | 状态                        |                   |
| role       | enum('user', 'Merchant') | 账号类型(个体用户 商铺用户) | 默认user          |
| created_at | datetime                 | 创建时间                    | CURRENT_TIMESTAMP |
| updated_at | datetime                 | 更新时间                    | CURRENT_TIMESTAMP |

## 订单表

| 字段               | 数据类型      | 说明                                                      | 备注              |
| ------------------ | ------------- | --------------------------------------------------------- | ----------------- |
| id                 | bigint        | 主键                                                      | 自增              |
| orderSn            | varchar(255)  | 订单号                                                    | 唯一              |
| buyer_id           | bigint        | 买家id                                                    | 外键              |
| total_amount       | decimal(10,2) | 订单金额                                                  |                   |
| status             | tinyint       | 订单状态(1待付款 2待发货 3待收货 4已完成 5已取消 6已退款) |                   |
| receive_address_id | bigint        | 收货地址id（可以为null 为null即线下直接交付）             | 外键              |
| created_at         | datetime      | 创建时间                                                  | CURRENT_TIMESTAMP |
| update_at          | datetime      | 更新时间                                                  | CURRENT_TIMESTAMP |

## 订单明细表

| url              | 数据类型      | 说明       | 备注              |
| ---------------- | ------------- | ---------- | ----------------- |
| id               | bigint        | 主键       | 自增              |
| order_id         | bigint        | 订单表id   | 外键              |
| product_id       | bigint        | 商品id     | 外键              |
| sku_id           | bigint        | 商品规格id | 外键              |
| seller_id        | bigint        | 卖家id     | 外键              |
| quantity         | int           | 购买数量   |                   |
| unit_price       | decimal(10,2) | 成交单价   |                   |
| product_snapshot | json          | 商品快照   |                   |
| created_at       | datetime      | 创建时间   | CURRENT_TIMESTAMP |
| updated_at       | datetime      | 更新时间   | CURRENT_TIMESTAMP |

## 地址表

| 字段          | 数据类型     | 说明                      | 备注           |
| ------------- | ------------ | ------------------------- | -------------- |
| id            | bigint       | 主键                      | 自增           |
| user_id       | bigint       | 用户id                    | 外键           |
| consignee     | varchar(50)  | 收货人                    |                |
| sex           | varchar(2)   | 性别                      |                |
| phone         | varchar(18)  | 手机号                    |                |
| province_code | varchar(12)  | 省份编码                  |                |
| province_name | varchar(32)  | 省份名称                  |                |
| city_code     | varchar(12)  | 城市编码                  |                |
| city_name     | varchar(32)  | 城市名称                  |                |
| district_code | varchar(12)  | 区县编码                  |                |
| district_name | varchar(32)  | 区县名称                  |                |
| detail        | varchar(200) | 详细地址                  | 具体到门牌号   |
| label         | varchar(100) | 标签                      | 公司、家、学校 |
| is_default    | tinyint      | 是否为默认地址（1是 0否） |                |

## 商品表

| 字段        | 数据类型      | 说明               | 备注                                                                               |
| ----------- | ------------- | ------------------ | ---------------------------------------------------------------------------------- |
| id          | bigint        | 主键               | 自增                                                                               |
| product_sn  | varchar(255)  | 商品号             | 唯一                                                                               |
| seller_id   | bigint        | 买家id             | 外键                                                                               |
| shop_id     | bigint        | 店铺id             | 外键                                                                               |
| title       | varchar(50)   | 商品标题（名称）   |                                                                                    |
| description | text          | 商品描述           |                                                                                    |
| category_id | bigint        | 分类id             | 外键                                                                               |
| price       | decimal(10,2) | 商品价格           | 当为正规商铺商品时 此处价格取商品所有规格的最低价                                  |
| condition   | tinyint       | 商品成色           | 非二手商品时，使用"非二手"(1:"全新",2:"9成新"，3:仅外观受损",4:"8成新",5:"非二手") |
| status      | tinyint       | 商品状态           | 1在售 2已预订(交涉中) 3已售出                                                      |
| location    | varchar(50)   | 商品所在地区和城市 |                                                                                    |
| view_count  | int           | 浏览次数           |                                                                                    |
| created_at  | datetime      | 创建时间           | CURRENT_TIMESTAMP                                                                  |
| updated_at  | datetime      | 更新时间           | CURRENT_TIMESTAMP                                                                  |

## 规格表

| 字段           | 数据类型      | 说明         | 备注              |
| -------------- | ------------- | ------------ | ----------------- |
| id             | bigint        | 主键         | 自增              |
| sku_sn         | varchar(255)  | 规格号       | 唯一              |
| product_id     | bigint        | 商品id       | 外键              |
| specifications | JSON          | 规格描述     |                   |
| price          | demical(10,2) | 该规格的价格 |                   |
| stock          | int           | 库存数量     | 不为负数          |
| sku_code       | varchar(100)  | SKU编码      |                   |
| updated_at     | datetime      | 更新时间     | CURRENT_TIMESTAMP |

## 管理员表

| 字段       | 数据类型                     | 说明                          | 备注              |
| ---------- | ---------------------------- | ----------------------------- | ----------------- |
| id         | bigint                       | 主键                          | 自增              |
| name       | varchar(25)                  | 姓名                          |                   |
| username   | varchar(25)                  | 用户名                        | 唯一              |
| password   | varchar(64)                  | 密码                          |                   |
| phone      | varchar(18)                  | 手机号                        |                   |
| gender     | varchar(2)                   | 性别                          |                   |
| id_number  | varchar(18)                  | 身份证号                      | 唯一              |
| status     | tinyint                      | 状态                          | 1正常 2锁定       |
| created_at | datetime                     | 创建时间                      | CURRENT_TIMESTAMP |
| updated_at | datetime                     | 更新时间                      | CURRENT_TIMESTAMP |
| create_id  | bigint                       | 创建者id                      |                   |
| update_id  | bigint                       | 更新者id                      |                   |
| role       | enum('admin', 'super_admin') | 账户类型 (管理员、超级管理员) | 默认为 admin      |

## 分类表

| 字段      | 数据类型     | 说明                     | 备注 |
| --------- | ------------ | ------------------------ | ---- |
| id        | bigint       | 主键                     | 自增 |
| name      | varchar(50)  | 分类名称                 |      |
| parent_id | bigint       | 父id（用于实现多级分类） | 外键 |
| icon_url  | varchar(255) | 分类图标里链接           |      |

## 商品图片表

| 字段       | 数据类型     | 说明     | 备注                        |
| ---------- | ------------ | -------- | --------------------------- |
| id         | bigint       | 主键     |                             |
| product_id | bigint       | 商品id   | 外键                        |
| sku_id     | bigint       | 规格id   | 外键（可为null）            |
| image_url  | varchar(255) | 图片url  |                             |
| image_type | tinyint      | 图片类型 | (1封面 2商品详细图 3规格图) |
| sort_order | tinyint      | 图片排序 | 值越小越靠前                |
| created_at | datetime     | 创建时间 | CURRENT_TIMESTAMP           |

## 聊天表

| 字段            | 数据类型     | 说明                                                             | 备注              |
| --------------- | ------------ | ---------------------------------------------------------------- | ----------------- |
| id              | bigint       | 主键                                                             | 自增              |
| conversation_id | varchar(100) | 消息唯一标识(将两个用户之间的所有来回消息聚合到同一个对话窗口中) | 唯一              |
| sender_id       | bigint       | 发送者id                                                         | 外键              |
| receiver_id     | bigint       | 接收者id                                                         | 外键              |
| content         | text         | 消息内容                                                         |                   |
| is_read         | boolean      | 是否已读                                                         |                   |
| sent_at         | datetime     | 发送时间                                                         | CURRENT_TIMESTAMP |

## 收藏表

| 字段       | 数据类型 | 说明     | 备注              |
| ---------- | -------- | -------- | ----------------- |
| id         | bigint   | 主键     | 自增              |
| user_id    | bigint   | 用户id   | 外键              |
| product_id | bigint   | 商品id   | 外键              |
| created_at | datetime | 收藏时间 | CURRENT_TIMESTAMP |
| updated_at | datetime | 更新时间 | CURRENT_TIMESTAMP |

## 评价与信用表

| 字段        | 数据类型 | 说明     | 备注              |
| ----------- | -------- | -------- | ----------------- |
| id          | bigint   | 主键     | 自增              |
| order_id    | bigint   | 订单id   | 外键              |
| reviewer_id | bigint   | 评价者id | 外键              |
| reviewee_id | bigint   | 被评价id | 外键              |
| rating      | tinyint  | 评分     | （1~5）           |
| comment     | text     | 评价内容 |                   |
| created_at  | datetime | 评价时间 | CURRENT_TIMESTAMP |

## 店铺表

| 字段        | 数据类型     | 说明           | 备注              |
| ----------- | ------------ | -------------- | ----------------- |
| id          | bigint       | 主键           | 自增              |
| user_id     | bigint       | 商家账户表     | 外键              |
| shop_name   | varchar(64)  | 商铺名称       |                   |
| description | varchar(255) | 商铺描述       |                   |
| logo_url    | varchar(255) | 商铺logo(头像) |                   |
| status      | tinyint      | 商铺状态       | 1开店中 2闭店中   |
| created_at  | datetime     | 创建时间       | CURRENT_TIMESTAMP |

## 活动商品关联表

| | | | |

## 优惠券模板表

| | | | |

## 用户优惠卷表

| | | | |
