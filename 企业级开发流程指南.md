# 仿闲鱼二手交易平台 - 企业级开发流程指南

## 📋 项目现状分析

### 已完成的工作

- ✅ 需求文档设计（功能优先级明确）
- ✅ 数据库设计（18张表，完整的外键约束）
- ✅ 接口设计文档（RESTful API规范）
- ✅ 技术实现计划（Spring Boot技术栈）
- ✅ 项目基础架构搭建（Maven多模块项目）

### 当前项目结构

```
Second-hand-market/
├── common/          # 公共模块
├── POJO/           # 实体类模块
├── server/         # 服务端模块
└── Second_hand-market/  # 文档目录
```

## 🚀 企业级开发流程

### 第一阶段：环境准备与基础搭建（第1周）

#### 1.1 开发环境配置

- [ ] **IDE配置**：IntelliJ IDEA + 必要插件

  - Lombok插件
  - MyBatis插件
  - RestfulTool插件
  - Git插件
- [ ] **数据库环境**

  ```bash
  # 创建数据库
  CREATE DATABASE secondhand CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

  # 执行建表脚本
  mysql -u root -p secondhand < Second_hand-market/date.sql
  ```
- [ ] **Redis环境**

  ```bash
  # 启动Redis服务
  redis-server
  ```
- [ ] **RabbitMQ环境**

  ```bash
  # 启动RabbitMQ服务
  rabbitmq-server
  ```

#### 1.2 项目依赖完善

- [ ] **完善server模块pom.xml**
  ```xml
  <!-- 添加缺失的依赖 -->
  <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
  </dependency>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-data-redis</artifactId>
  </dependency>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-amqp</artifactId>
  </dependency>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-security</artifactId>
  </dependency>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-validation</artifactId>
  </dependency>
  ```

#### 1.3 配置文件设置

- [ ] **application.yml配置**
  ```yaml
  spring:
    datasource:
      url: jdbc:mysql://localhost:3306/secondhand?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
      username: root
      password: your_password
      driver-class-name: com.mysql.cj.jdbc.Driver

    redis:
      host: localhost
      port: 6379
      database: 0
      timeout: 5000ms

    rabbitmq:
      host: localhost
      port: 5672
      username: guest
      password: guest

  mybatis:
    mapper-locations: classpath:mapper/*.xml
    type-aliases-package: com.zhuxi.pojo.entity
    configuration:
      map-underscore-to-camel-case: true
      log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  ```

### 第二阶段：核心模块开发（第2-4周）

#### 2.1 公共模块开发（第2周）

**优先级：🔴 最高**

- [ ] **统一响应结果类**

  ```java
  // common/src/main/java/com/zhuxi/common/result/Result.java
  @Data
  @AllArgsConstructor
  @NoArgsConstructor
  public class Result<T> {
      private Integer code;
      private String message;
      private T data;
      private Long timestamp;

      public static <T> Result<T> success(T data) {
          return new Result<>(200, "success", data, System.currentTimeMillis());
      }
  }
  ```
- [ ] **分页结果类**

  ```java
  // common/src/main/java/com/zhuxi/common/result/PageResult.java
  @Data
  @AllArgsConstructor
  @NoArgsConstructor
  public class PageResult<T> {
      private List<T> list;
      private Long total;
      private Integer page;
      private Integer size;
  }
  ```
- [ ] **业务异常类**

  ```java
  // common/src/main/java/com/zhuxi/common/exception/BusinessException.java
  public class BusinessException extends RuntimeException {
      private Integer code;
      private String message;

      public BusinessException(String message) {
          super(message);
          this.code = 500;
          this.message = message;
      }
  }
  ```
- [ ] **JWT工具类**

  ```java
  // common/src/main/java/com/zhuxi/common/utils/JwtUtil.java
  @Component
  public class JwtUtil {
      private static final String SECRET = "secondhand-market-secret-key";
      private static final int EXPIRE_TIME = 7 * 24 * 60 * 60 * 1000; // 7天

      public String generateToken(String username) {
          return Jwts.builder()
                  .setSubject(username)
                  .setExpiration(new Date(System.currentTimeMillis() + EXPIRE_TIME))
                  .signWith(SignatureAlgorithm.HS512, SECRET)
                  .compact();
      }

      public String getUsernameFromToken(String token) {
          return Jwts.parser()
                  .setSigningKey(SECRET)
                  .parseClaimsJws(token)
                  .getBody()
                  .getSubject();
      }
  }
  ```

#### 2.2 实体类开发（第2周）

**优先级：🔴 最高**

- [ ] **用户实体类**

  ```java
  // POJO/src/main/java/com/zhuxi/pojo/entity/User.java
  @Data
  @TableName("user")
  public class User {
      @TableId(type = IdType.AUTO)
      private Long id;

      private String userSn;
      private String username;
      private String password;
      private String nickname;
      private String email;
      private String phone;
      private String avatar;
      private Integer status;
      private String role;

      @TableField(fill = FieldFill.INSERT)
      private LocalDateTime createdAt;

      @TableField(fill = FieldFill.INSERT_UPDATE)
      private LocalDateTime updatedAt;
  }
  ```
- [ ] **商品实体类**

  ```java
  // POJO/src/main/java/com/zhuxi/pojo/entity/Product.java
  @Data
  @TableName("product")
  public class Product {
      @TableId(type = IdType.AUTO)
      private Long id;

      private String productSn;
      private Long sellerId;
      private Long shopId;
      private String title;
      private String description;
      private Long categoryId;
      private BigDecimal price;
      private Integer condition;
      private Integer status;
      private String location;
      private Integer viewCount;

      @TableField(fill = FieldFill.INSERT)
      private LocalDateTime createdAt;

      @TableField(fill = FieldFill.INSERT_UPDATE)
      private LocalDateTime updatedAt;
  }
  ```
- [ ] **订单实体类**

  ```java
  // POJO/src/main/java/com/zhuxi/pojo/entity/UserOrder.java
  @Data
  @TableName("user_order")
  public class UserOrder {
      @TableId(type = IdType.AUTO)
      private Long id;

      private String orderSn;
      private Long buyerId;
      private BigDecimal totalAmount;
      private Integer status;
      private Long receiveAddressId;

      @TableField(fill = FieldFill.INSERT)
      private LocalDateTime createdAt;

      @TableField(fill = FieldFill.INSERT_UPDATE)
      private LocalDateTime updatedAt;
  }
  ```

#### 2.3 用户管理模块（第3周）

**优先级：🔴 最高**

- [ ] **用户Mapper接口**

  ```java
  // server/src/main/java/com/zhuxi/server/mapper/UserMapper.java
  @Mapper
  public interface UserMapper extends BaseMapper<User> {
      User selectByUsername(String username);
      User selectByPhone(String phone);
      User selectByEmail(String email);
  }
  ```
- [ ] **用户Service接口和实现**

  ```java
  // server/src/main/java/com/zhuxi/server/service/UserService.java
  public interface UserService {
      Result<String> register(UserRegisterDTO registerDTO);
      Result<LoginResponseDTO> login(LoginDTO loginDTO);
      Result<UserInfoDTO> getUserInfo(String userSn);
      Result<Void> updateUserInfo(String userSn, UserUpdateDTO updateDTO);
  }
  ```
- [ ] **用户Controller**

  ```java
  // server/src/main/java/com/zhuxi/server/controller/UserController.java
  @RestController
  @RequestMapping("/api/v1/users")
  public class UserController {

      @PostMapping("/register")
      public Result<String> register(@RequestBody @Valid UserRegisterDTO registerDTO) {
          return userService.register(registerDTO);
      }

      @PostMapping("/login")
      public Result<LoginResponseDTO> login(@RequestBody @Valid LoginDTO loginDTO) {
          return userService.login(loginDTO);
      }

      @GetMapping("/{userSn}")
      public Result<UserInfoDTO> getUserInfo(@PathVariable String userSn) {
          return userService.getUserInfo(userSn);
      }
  }
  ```

#### 2.4 商品管理模块（第4周）

**优先级：🔴 最高**

- [ ] **商品Mapper接口**

  ```java
  // server/src/main/java/com/zhuxi/server/mapper/ProductMapper.java
  @Mapper
  public interface ProductMapper extends BaseMapper<Product> {
      List<Product> selectByCondition(ProductQueryDTO queryDTO);
      Product selectByProductSn(String productSn);
      List<Product> selectBySellerId(Long sellerId);
  }
  ```
- [ ] **商品Service接口和实现**

  ```java
  // server/src/main/java/com/zhuxi/server/service/ProductService.java
  public interface ProductService {
      Result<String> publishProduct(ProductPublishDTO publishDTO);
      Result<PageResult<Product>> getProductList(ProductQueryDTO queryDTO);
      Result<ProductDetailDTO> getProductDetail(String productSn);
      Result<Void> updateProduct(String productSn, ProductUpdateDTO updateDTO);
      Result<Void> deleteProduct(String productSn);
  }
  ```

### 第三阶段：业务功能开发（第5-7周）

#### 3.1 订单管理模块（第5周）

**优先级：🔴 最高**

- [ ] **订单创建流程**

  - 商品状态验证
  - 库存检查
  - 订单生成
  - 商品状态更新
- [ ] **订单状态管理**

  - 待付款 → 待发货 → 待收货 → 已完成
  - 订单取消逻辑
  - 退款处理

#### 3.2 地址管理模块（第5周）

**优先级：🔴 最高**

- [ ] **地址CRUD操作**
- [ ] **默认地址设置**
- [ ] **地址验证**

#### 3.3 收藏功能（第6周）

**优先级：🔴 最高**

- [ ] **商品收藏/取消收藏**
- [ ] **收藏列表查询**
- [ ] **收藏状态检查**

#### 3.4 搜索功能（第6周）

**优先级：🔴 最高**

- [ ] **关键词搜索**
- [ ] **分类筛选**
- [ ] **价格排序**
- [ ] **分页查询**

### 第四阶段：增强功能开发（第8-9周）

#### 4.1 通讯模块（第8周）

**优先级：🟡 中等**

- [ ] **WebSocket配置**
- [ ] **聊天功能实现**
- [ ] **消息存储**
- [ ] **在线状态管理**

#### 4.2 评价系统（第8周）

**优先级：🟡 中等**

- [ ] **交易评价**
- [ ] **评价展示**
- [ ] **信用计算**

#### 4.3 文件上传（第9周）

**优先级：🟡 中等**

- [ ] **图片上传**
- [ ] **文件存储**
- [ ] **图片压缩**

### 第五阶段：系统优化与部署（第10周）

#### 5.1 性能优化

**优先级：🟡 中等**

- [ ] **Redis缓存优化**

  ```java
  @Cacheable(value = "product", key = "#productSn")
  public Product getProductBySn(String productSn) {
      return productMapper.selectByProductSn(productSn);
  }
  ```
- [ ] **数据库索引优化**
- [ ] **分页查询优化**

#### 5.2 安全加固

**优先级：🔴 最高**

- [ ] **Spring Security配置**
- [ ] **JWT认证拦截器**
- [ ] **参数验证**
- [ ] **SQL注入防护**

#### 5.3 异常处理

**优先级：🔴 最高**

- [ ] **全局异常处理器**
  ```java
  @RestControllerAdvice
  public class GlobalExceptionHandler {

      @ExceptionHandler(BusinessException.class)
      public Result<Void> handleBusinessException(BusinessException e) {
          return Result.error(e.getCode(), e.getMessage());
      }

      @ExceptionHandler(MethodArgumentNotValidException.class)
      public Result<Void> handleValidationException(MethodArgumentNotValidException e) {
          return Result.error(400, "参数验证失败");
      }
  }
  ```

## 🎯 开发优先级建议

### 第一优先级（必须完成）

1. **用户认证模块** - 注册、登录、JWT认证
2. **商品管理模块** - 发布、查询、详情
3. **订单管理模块** - 创建、状态管理
4. **基础搜索功能** - 关键词搜索、分页

### 第二优先级（重要功能）

1. **地址管理** - 收货地址CRUD
2. **收藏功能** - 商品收藏
3. **文件上传** - 图片上传
4. **异常处理** - 全局异常处理

### 第三优先级（增强功能）

1. **通讯功能** - WebSocket聊天
2. **评价系统** - 交易评价
3. **缓存优化** - Redis缓存
4. **性能优化** - 数据库优化

## 📝 开发规范

### 代码规范

- 使用Lombok减少样板代码
- 统一异常处理
- 统一响应格式
- 参数验证使用@Valid
- 日志记录使用@Slf4j

### 数据库规范

- 使用业务编号而非数据库ID
- 外键约束保证数据一致性
- 合理的索引设计
- 字段注释完整

### API规范

- RESTful设计风格
- 统一的响应格式
- 合理的HTTP状态码
- 完整的错误信息

## 🚀 快速开始指南

### 1. 立即开始的工作

```bash
# 1. 完善server模块依赖
# 编辑 server/pom.xml，添加缺失的依赖

# 2. 创建配置文件
# 创建 server/src/main/resources/application.yml

# 3. 执行数据库脚本
mysql -u root -p secondhand < Second_hand-market/date.sql

# 4. 启动项目
cd server
mvn spring-boot:run
```

### 2. 第一个接口开发

建议从用户注册接口开始：

1. 创建User实体类
2. 创建UserMapper接口
3. 创建UserService实现
4. 创建UserController
5. 测试接口

### 3. 开发顺序建议

```
Week 1: 环境搭建 + 用户认证
Week 2: 商品管理基础功能
Week 3: 订单管理 + 地址管理
Week 4: 搜索功能 + 收藏功能
Week 5: 文件上传 + 异常处理
Week 6: 性能优化 + 测试
```

## 📊 项目里程碑

- **Week 2**: 用户认证完成，可以注册登录
- **Week 4**: 商品管理完成，可以发布和浏览商品
- **Week 6**: 订单流程完成，可以下单购买
- **Week 8**: 基础功能完成，系统可正常使用
- **Week 10**: 项目完成，可以部署上线

这个开发流程遵循企业级开发标准，确保项目的可维护性、可扩展性和稳定性。按照这个流程开发，你将获得一个完整的、符合企业标准的二手交易平台项目。
