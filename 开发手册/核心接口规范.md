# 核心接口规范

## 统一响应格式

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1640995200000
}
```

## 用户

### 用户注册
```http
POST /user/register
Content-Type: application/json
```
请求体：
```json
{
  "username": "testuser",
  "password": "password123",
  "phone": "13800138000",
  "email": "test@example.com",
  "nickname": "换换1234"
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userSn": "USR202401010001",
    "nickname": "换换1234",
    "role": "user",
    "avatar": "https://example.com/avatar.jpg"
  },
  "timestamp": 1640995200000
}
```

### 用户登录
```http
POST /user/login
Content-Type: application/json
```
请求体：
```json
{
  "username": "testuser",
  "password": "password123"
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userSn": "USR202401010001",
    "nickname": "换换1234",
    "role": "user",
    "avatar": "https://example.com/avatar.jpg",
    "accessToken": "ey...",
    "refreshToken": "we...",
    "accessExpireTime": 1640995200000,
    "refreshExpireTime": 1641600000000
  },
  "timestamp": 1640995200000
}
```

### 用户登出
```http
POST /user/logout/{userSn}
Authorization: Bearer <token>
```
请求参数：
- 路径参数：`userSn`
- 头：`Authorization`

响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

### 刷新令牌
```http
POST /user/refresh
Content-Type: application/json
```
请求体：
```json
{
  "userSn": "USR202401010001",
  "refreshToken": "we..."
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "accessToken": "ey...",
    "accessExpireTime": 1640995200000
  },
  "timestamp": 1640995200000
}
```

### 获取用户信息
```http
GET /user/me/getInfo/{userSn}
Authorization: Bearer <token>
```
请求参数：
- 路径参数：`userSn`
- 头：`Authorization`

响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userSn": "USR202401010001",
    "username": "testuser",
    "nickname": "换换1234",
    "phone": "13800138000",
    "email": "test@example.com",
    "avatar": "https://example.com/avatar.jpg",
    "gender": 1,
    "role": "user",
    "userStatus": 1,
    "createdAt": "2024-01-01T00:00:00Z"
  },
  "timestamp": 1640995200000
}
```

### 修改密码
```http
PUT /user/me/{userSn}/password
Authorization: Bearer <token>
Content-Type: application/json
```
请求体：
```json
{
  "oldPassword": "oldPass123",
  "newPassword": "newPass123"
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

### 更新用户信息
```http
PUT /user/me/update/{userSn}
Authorization: Bearer <token>
Content-Type: application/json
```
请求体：
```json
{
  "nickname": "新昵称",
  "email": "new@example.com",
  "gender": 1,
  "avatar": "https://example.com/new-avatar.jpg"
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

## 地址

### 获取地址列表
```http
GET /user/me/{userSn}/addresses
Authorization: Bearer <token>
```
请求参数：
- 路径参数：`userSn`
- 头：`Authorization`

响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "addressSn": "ADDR202401010001",
      "consignee": "张三",
      "sex": "男",
      "phone": "13800138000",
      "provinceName": "北京市",
      "cityName": "北京市",
      "districtName": "东城区",
      "detail": "某某街道123号",
      "label": "家",
      "isDefault": true,
      "createdAt": "2024-01-01T00:00:00Z"
    }
  ],
  "timestamp": 1640995200000
}
```

### 添加地址
```http
POST /user/me/{userSn}/addresses
Authorization: Bearer <token>
Content-Type: application/json
```
请求体：
```json
{
  "consignee": "张三",
  "phone": "13800138000",
  "provinceCode": "110000",
  "provinceName": "北京市",
  "cityCode": "110100",
  "cityName": "北京市",
  "districtCode": "110101",
  "districtName": "东城区",
  "detail": "某某街道123号",
  "label": "家",
  "isDefault": 1
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": "ADDR202401010001",
  "timestamp": 1640995200000
}
```

### 更新地址
```http
PUT /user/me/{userSn}/addresses/{addressSn}
Authorization: Bearer <token>
Content-Type: application/json
```
请求体：
```json
{
  "consignee": "李四",
  "phone": "13800138001",
  "detail": "更新后的地址",
  "label": "公司",
  "isDefault": 0
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

### 删除地址
```http
DELETE /user/me/{userSn}/addresses/{addressSn}
Authorization: Bearer <token>
```
请求参数：
- 路径参数：`userSn`,`addressSn`
- 头：`Authorization`

响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

## 商品

### 类目列表
```http
GET /product/categories
```
请求参数：
- 查询：`limit`(默认100),`offset`(默认0)

响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "手机",
      "children": []
    }
  ],
  "timestamp": 1640995200000
}
```

### 成色枚举
```http
GET /product/conditions
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {"code": 1, "label": "全新"},
    {"code": 2, "label": "95新"}
  ],
  "timestamp": 1640995200000
}
```

### 二手列表
```http
GET /product/shProductList
```
请求参数：
- 查询：`page`,`size`,`categoryId`,`keyword`,`order`

响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "productSn": "PRD202401010001",
      "title": "iPhone 13 Pro",
      "price": 6999.00,
      "condition": 2,
      "viewCount": 156,
      "sellerSn": "USR202401010001",
      "coverImage": "https://example.com/cover.jpg",
      "createdAt": "2024-01-01T00:00:00Z"
    }
  ],
  "timestamp": 1640995200000
}
```

### 二手详情
```http
GET /product/shProductDetail?productSn=PRD202401010001
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "productSn": "PRD202401010001",
    "title": "iPhone 13 Pro",
    "description": "描述",
    "price": 6999.00,
    "condition": 2,
    "seller": {
      "sellerSn": "USR202401010001",
      "nickname": "卖家昵称",
      "avatar": "https://example.com/avatar.jpg"
    },
    "images": ["https://example.com/a.jpg"],
    "createdAt": "2024-01-01T00:00:00Z"
  },
  "timestamp": 1640995200000
}
```

### 修改商品
```http
POST /product/updateProduct
Authorization: Bearer <token>
Content-Type: application/json
```
请求体：
```json
{
  "productSn": "PRD202401010001",
  "title": "更新标题",
  "description": "更新描述",
  "price": 6500.00,
  "condition": 3,
  "categoryId": 2,
  "location": "北京市海淀区",
  "isDraft": 0,
  "userSn": "USR202401010001"
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

### 删除商品
```http
POST /product/delProduct
Authorization: Bearer <token>
```
请求参数：
- 查询：`productSn`,`userSn`

响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

### 我的商品
```http
GET /product/meShProductList?userSn=USR202401010001
Authorization: Bearer <token>
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "productSn": "PRD202401010001",
      "title": "iPhone 13 Pro",
      "userStatus": 1,
      "createdAt": "2024-01-01T00:00:00Z"
    }
  ],
  "timestamp": 1640995200000
}
```

## 订单（待完成）

### 创建订单
```http
POST /order
Authorization: Bearer <token>
Content-Type: application/json
```
请求体：
```json
{
  "buyerSn": "USR202401010002",
  "sellerSn": "USR202401010001",
  "productSn": "PRD202401010001",
  "quantity": 1,
  "addressSn": "ADDR202401010001",
  "remark": "尽快发货"
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "orderSn": "ORD202401010001"
  },
  "timestamp": 1640995200000
}
```

### 获取订单详情
```http
GET /order/{orderSn}
Authorization: Bearer <token>
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "orderSn": "ORD202401010001",
    "status": 1,
    "buyerSn": "USR202401010002",
    "sellerSn": "USR202401010001",
    "productSn": "PRD202401010001",
    "amount": 6500.00,
    "createdAt": "2024-01-01T00:00:00Z"
  },
  "timestamp": 1640995200000
}
```

### 更新订单状态
```http
PUT /order/{orderSn}/status
Authorization: Bearer <token>
Content-Type: application/json
```
请求体：
```json
{
  "userStatus": 2,
  "remark": "已发货，快递单号：SF1234567890"
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

### 我的订单列表
```http
GET /user/me/{userSn}/orders?page=1&size=20
Authorization: Bearer <token>
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {"orderSn": "ORD202401010001", "status": 1, "amount": 6500.00}
    ],
    "total": 1,
    "page": 1,
    "size": 20
  },
  "timestamp": 1640995200000
}
```

### 取消订单
```http
POST /order/{orderSn}/cancel
Authorization: Bearer <token>
Content-Type: application/json
```
请求体：
```json
{
  "reason": "买家取消"
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

## 收藏（待完成）

### 收藏商品
```http
POST /user/me/{userSn}/collections
Authorization: Bearer <token>
Content-Type: application/json
```
请求体：
```json
{
  "productSn": "PRD202401010001"
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

### 取消收藏
```http
DELETE /user/me/{userSn}/collections/{productSn}
Authorization: Bearer <token>
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": null,
  "timestamp": 1640995200000
}
```

### 收藏列表
```http
GET /user/me/{userSn}/collections?page=1&size=20
Authorization: Bearer <token>
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "productSn": "PRD202401010001",
        "title": "iPhone 13 Pro",
        "price": 6999.00,
        "condition": 2,
        "coverImage": "https://example.com/cover.jpg",
        "createdAt": "2024-01-01T00:00:00Z"
      }
    ],
    "total": 1,
    "page": 1,
    "size": 20
  },
  "timestamp": 1640995200000
}
```

## 搜索（待完成）

### 商品搜索
```http
GET /search/products?q=iphone&page=1&size=20&categoryId=1&order=price_desc
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {"productSn": "PRD202401010001", "title": "iPhone 13 Pro", "price": 6999.00}
    ],
    "total": 100,
    "page": 1,
    "size": 20
  },
  "timestamp": 1640995200000
}
```

## 商品发布（待完成）

### 发布商品
```http
POST /user/me/{userSn}/products
Authorization: Bearer <token>
Content-Type: application/json
```
请求体：
```json
{
  "title": "iPhone 13 Pro",
  "description": "99新，保修内",
  "price": 6999.00,
  "condition": 2,
  "categoryId": 1,
  "location": "北京市海淀区",
  "images": ["https://example.com/a.jpg"]
}
```
响应体：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "productSn": "PRD202401010001"
  },
  "timestamp": 1640995200000
}
```
